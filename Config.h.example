// Include guard to prevent redefinitions when included via multiple modules
#ifndef ENV_STATION_CONFIG_H
#define ENV_STATION_CONFIG_H

// ---------- Helpers ----------
#ifndef ARRLEN
#define ARRLEN(a) (sizeof(a) / sizeof((a)[0]))
#endif

#define MIN 60UL * 1000UL
#define SEC 1000UL

// ---------- Pins ----------
constexpr uint8_t RS485_DIR_PIN = 5;  // DE/RE for RS-485 (Sensor Box)
constexpr uint8_t BDBG_DIR_PIN  = 4;  // TX enable for BDBG line (if used)
constexpr uint8_t ETH_CS = 10; // Ethernet CS

// ---------- UART Speeds & Formats ----------
constexpr uint32_t SERIAL0_BAUD = 115200; // USB debug
constexpr uint32_t SERIAL2_BAUD = 19200;  // BDBG-09
constexpr uint32_t SERIAL3_BAUD = 9600;   // Sensor Box

// ---------- BDBG-09 UART Timings ----------
constexpr uint32_t BDBG_FIRST_BYTE_TIMEOUT_MS  = 500;
constexpr uint32_t BDBG_INTERBYTE_TIMEOUT_MS   = 50;

// ---------- Sensor Box (Modbus RTU) ----------
// Primary/extra device IDs
const uint8_t PRIMARY_IDS[]      = { 2, 4, 6, 7 };
const uint8_t PRIMARY_COUNT      = ARRLEN(PRIMARY_IDS);
const uint8_t EXTRA_IF_ONLY2[]   = { 2 };
const uint8_t EXTRA_IF_ONLY4[]   = { 4, 3, 8 };
const uint8_t EXTRA_IF_ONLY6[]   = { 6, 5 };
const uint8_t EXTRA_IF_ONLY7[]   = { 7, 5 };
const uint8_t EXTRA_ONLY2_CNT    = ARRLEN(EXTRA_IF_ONLY2);
const uint8_t EXTRA_ONLY4_CNT    = ARRLEN(EXTRA_IF_ONLY4);
const uint8_t EXTRA_ONLY6_CNT    = ARRLEN(EXTRA_IF_ONLY6);
const uint8_t EXTRA_ONLY7_CNT    = ARRLEN(EXTRA_IF_ONLY7);

// Remote bridge (ID 4)
const IPAddress ip_4(192, 168, 0, 1);
const IPAddress ip_3(192, 168, 0, 1);
const IPAddress ip_8(192, 168, 0, 1);
const int       port       = 5581; 
uint8_t         time_sleep = 20;

/// PM sensor map
const uint8_t  PM_ID             = 10;
const uint8_t  PM_START_ADDR     = 1;
const uint8_t  PM_REG_COUNT      = 2;
const int pm_divider = 1000;


// Gas register map
constexpr uint16_t GAS_START_ADDR = 20;
constexpr uint16_t GAS_REG_COUNT  = 6;

// Gas register map for 2 id
constexpr uint16_t GAS_START_ADDR2 = 0;
constexpr uint16_t GAS_REG_COUNT2  = 6;
const int co_divider = 100;
const int so2_no2_divider = 1000;


// ---------- Ethernet  ----------
// Local TCP server
constexpr uint16_t MODBUS_TCP_PORT = 502;
static const byte      MAC_ADDR[]  = { 0x02, 0x11, 0x22, 0x00, 0x00, 0x01 };
static const IPAddress STATIC_IP(192, 168, 0, 101);
static const IPAddress DNS_IP(192, 168, 0, 1);
uint8_t resp[256];

// Remote Server
// static const IPAddress SERVER_IP(176, 38, 51, 58);
static const char* SERVER_IP = "example.com";
uint16_t server_port = 4000;
const char API_KEY[] = "4f****7a"; maximum allowed line length 36

// ---------- Relay ----------
IPAddress   NET_CHECK_IP(8, 8, 8, 8); // Google DNS
const uint16_t NET_CHECK_PORT     = 53; 
const uint8_t  UNIT_ID            = 12; // ID пристрою
const uint8_t  CH                 = 0;  // Канал взаємодії від 0-3
constexpr uint32_t RELAY_PULSE_MS =  2 * MIN; // хв

// ---------- Periods / Timings (ms) ----------
constexpr uint32_t BDBG_REQ_PERIOD_MS    = 30 * SEC; // сек
constexpr uint32_t DRAW_MONITORING = 2 * SEC; // сек
constexpr uint32_t RELAY_SLEEP = 10 * MIN; // хв
constexpr uint32_t SEND_DATA_TO_SERVER = 1 * MIN; // хв
 

// ---------- Exported Data Array ----------
constexpr int   SEND_ARR_SIZE    = 30;   // number of float32 values exposed (2 regs each)
constexpr float DEFAULT_SEND_VAL = -1.0f;

// ---------- Display Paramter ---------
const int col1_x = 0, col1_x_value = 80;
const int col2_x = 170, intcol2_x_value = 240; 
const int col3_x = 330, col3_x_value = 410;
const int y_step = 30; // Крок відступу
const int len_col = 7; // Кількість елементів в стопчику


enum ChannelIndex : uint8_t {
  CH_CO = 0,
  CH_SO2,
  CH_NO2,
  CH_NO,
  CH_H2S,
  CH_O3,
  CH_NH3,
  CH_PM2_5,
  CH_PM10,
  CH_R,
  CH_S_T,
  CH_S_RH,
  CH_TOTAL_COUNT
};
constexpr size_t CH_COUNT = CH_TOTAL_COUNT;

struct LabelEntry {
  const char* name;
  ChannelIndex channel;
  bool useStd;
};

#define LABEL_AVG(name, channel) { name, channel, false }
#define LABEL_STD(name, channel) { name, channel, true }

const LabelEntry labels[] = {
  LABEL_AVG("CO",    CH_CO),
  LABEL_AVG("SO2",   CH_SO2),
  LABEL_AVG("NO2",   CH_NO2),
  LABEL_AVG("NO",    CH_NO),
  LABEL_AVG("H2S",   CH_H2S),
  LABEL_AVG("O3",    CH_O3),
  LABEL_AVG("NH3",   CH_NH3),
  LABEL_AVG("PM2.5", CH_PM2_5),
  LABEL_AVG("PM10",  CH_PM10),
  LABEL_AVG("R",     CH_R),
  LABEL_AVG("S_T",   CH_S_T),
  LABEL_AVG("S_RH",  CH_S_RH),
  LABEL_STD("S_CO",   CH_CO),
  LABEL_STD("S_SO2",  CH_SO2),
  LABEL_STD("S_NO2",  CH_NO2),
  LABEL_STD("S_NO",   CH_NO),
  LABEL_STD("S_H2S",  CH_H2S),
  LABEL_STD("S_O3",   CH_O3),
  LABEL_STD("S_NH3",  CH_NH3)
};

#undef LABEL_AVG
#undef LABEL_STD

constexpr size_t labels_len = sizeof(labels) / sizeof(labels[0]);

// Test values
static const float INIT_SEND_ARR_0_13[][6] = {
  { -0.7,  -0.69, -0.71, -0.68, -0.72, -0.67 },
  {  0.1,   0.11,  0.09,  0.12,  0.08,  0.13 },
  {  0.01,  0.02,  0,     0.03, -0.01,  0.04 },
  {  0.2,   0.21,  0.19,  0.22,  0.18,  0.23 },
  { 22.6,  23.05, 22.15, 22.83, 22.37, 22.8  },
  { 56,    57.12, 54.88, 56.56, 55.44, 56.2  },
  {  4.76,  5,     4.52,  4.88,  4.64,  4.79 },
  {  5.6,   5.88,  5.32,  5.74,  5.46,  5.63 },
  { 28,    28.56, 27.44, 28.28, 27.72, 28.2  },
  {  3,     3.15,  2.85,  3.07,  2.92,  3.03 },
  { 540,  545.4, 534.6, 542.7, 537.3, 541    },
  {1010.22,1020.32,1000.12,1015.27,1005.17,1011.22},
  {  9,     9.45,  8.55,  9.22,  8.78,  9.03 },
  {  1.1,   1.16,  1.04,  1.13,  1.07,  1.13 },
  {  0.5,   0.51,  0.49,  0.52,  0.48,  0.53 },
  {  1,     1.05,  0.95,  1.02,  0.97,  1.03 },
  {  0,     0.01, -0.01,  0.02, -0.02,  0.03 },
  { 18,    18.36, 17.64, 18.18, 17.82, 18.2  },
  { 19,    19.38, 18.62, 19.19, 18.81, 19.2  },
  { 24.5,  24.99, 24.01, 24.75, 24.25, 24.7  },
  { 24.5,  24.99, 24.01, 24.75, 24.25, 24.7  }
};

#endif // ENV_STATION_CONFIG_H
